<template>
  <div class="climate">
    <div class="first-content-wrapper">
      <div class="first-screen screen">
        <div class="mountain-1"></div>
        <div class="mountain-2"></div>
        <div class="mountain-3"></div>
        <div class="mountain-4"></div>
        <div class="mountain-5"></div>
        <div class="cloud-1"></div>
        <div class="cloud-2"></div>
        <div class="cloud-3"></div>
        <div class="cloud-4"></div>
        <div class="cloud-5"></div>
        <div class="cloud-6"></div>
        <div class="text"><span>青藏高原</span>的平均海拔超过<span>4000</span>米，从冰雪冻原到山地雨林，从干燥荒漠到温润谷地，高原以独特的气候节律，铺展出一幅壮丽而多变的自然画卷。</div>
      </div>
    </div>
    <div class="content-box">
      <div class="second-screen screen second-single">
        <div class="img-bg"></div>
        <div class="content-wrapper">
          <div class="img-map"></div>
          <div class="img-picture"></div>
          <div class="detail">
            <div class="title">羌塘高原区域</div>
            <p>羌塘高原大部分地区都寒冷干燥，特别是北部羌塘高原，日最低气温几乎全年都在0℃以下。这里降水量稀少，而且主要以固态形式，比如降雪、冰雹为主。冬春季节多有大风、酷寒，气候十分恶劣。因为高寒和干燥，这里的植被也稀疏而贫瘠。即便是南部羌塘高原，要种植农作物也难以正常生长成熟。属于我国高原寒带干旱和高原亚寒带半干旱气候区。</p>
          </div>
        </div>
      </div>
    </div>
    <div class="content-box">
      <div class="third-screen screen second-single">
        <div class="img-bg"></div>
        <div class="img-bg-video">
          <video
              src="@/assets/images/climate/climate-cdm-storm.webm"
              autoplay
              loop
              disablePictureInPicture
              muted
              playsinline
          ></video>
        </div>
        <div class="content-wrapper">
          <div class="img-map"></div>
          <div class="img-picture"></div>
          <div class="detail">
            <div class="title">柴达木盆地区域</div>
            <p>大风、干燥、黄沙，可能是柴达木盆地给人们的第一印象。由于青藏高原抬升阻挡了印度洋季风水汽，使得这里年降水量自东南部的200毫米可以逐渐递减到西北部的15毫米，是我国著名的干旱盆地之一。柴达木盆地的风力也极为强盛，8级以上大风日数全年可达25～75天，也正因如此，奇特的风蚀地貌在这里非常常见。</p>
          </div>
        </div>
      </div>
    </div>
    <div class="content-box">
      <div class="four-screen screen second-single">
        <div class="img-bg">
          <video
              src="@/assets/images/climate/climate-zngd-bg-1.mp4"
              autoplay
              loop
              muted
              playsinline
              disablePictureInPicture
          ></video>
        </div>
        <div class="img-bg-2"></div>
        <div class="content-wrapper">
          <div class="img-map"></div>
          <div class="img-picture"></div>
          <div class="detail">
            <div class="title">藏南谷地区域</div>
            <p>这里被誉为“西藏粮仓”，也是西藏古文明的发祥地，属于我国的高原温带半干旱气候区。藏南谷地位于冈底斯山至念青唐古拉山以南、雅鲁藏布江中游的宽谷地带。最暖月平均气温在10-15℃，年降水量约400毫米，普遍在夜间降雨，是青藏高原夜雨最多的地区之一。因此，藏南谷地也成为高原上最为重要的农业区：小麦、青稞等作物都能获得较高的产量。</p>
          </div>
        </div>
      </div>
    </div>
    <div class="content-box">
      <div class="five-screen screen second-single">
        <div class="img-bg"></div>
        <div class="img-bg-2">
          <video
              src="@/assets/images/climate/climate-hds-cloud.webm"
              autoplay
              loop
              muted
              playsinline
              disablePictureInPicture
          ></video>
        </div>
        <div class="content-wrapper">
          <div class="img-map"></div>
          <div class="img-picture"></div>
          <div class="detail">
            <div class="title">横断山脉区域</div>
            <p>横断山脉地处青藏高原的东部边缘，地形复杂、山高谷深、海拔垂直变化大，所以这里的气候也具有明显的垂直气候分布差异。海拔较高处主要以冷杉等针叶林为主，往下则以桦树、铁杉等针阔混交林和落叶阔叶林为主。受南亚季风和东亚季风共同影响，横断山脉区域的降水较为丰沛，年降水量约500-1000毫米，属于我国高原温带湿润气候区。</p>
          </div>
        </div>
      </div>
    </div>
    <div class="content-box">
      <div class="six-screen screen second-single">
        <div class="img-bg-video img-bg">
          <video
              src="@/assets/images/climate/climate-zdn-bg.mp4"
              autoplay
              loop
              muted
              playsinline
              disablePictureInPicture
          ></video>
        </div>
        <div class="content-wrapper">
          <div class="img-map"></div>
          <div class="img-picture"></div>
          <div class="detail">
            <div class="title">藏东南区域</div>
            <p>这里是喜马拉雅山脉南翼低山地区。因为水流侵蚀，峡谷深切，垂直高差很大，察隅、墨脱等地都处在这个区域。越靠近喜马拉雅山南翼外缘，海拔越低，全年日平均气温越高，几乎都在10℃以上，降水量多达2500毫米。气候温暖湿润，热带常绿雨林、季雨林在这里非常常见，甚至可以种植香蕉等热带水果。属于我国亚热带和热带山地湿润气候区。</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup>
import { ref, onMounted, onBeforeUnmount } from 'vue'
import { gsap } from 'gsap';
import { pxToVw, pxToVh } from '../../utils/viewportUtils';
import { ScrollTrigger } from "gsap/ScrollTrigger";
gsap.registerPlugin(ScrollTrigger)
const calDistance = (distance) =>{
  return distance / 6480
}
const firstAnimation = () =>{
  const tl = gsap.timeline({
    scrollTrigger: {
      trigger: '.first-content-wrapper',
      start: 'top top',
      end: '+=1000',
      scrub: 0.1, // 增加延迟
      pin: true,
      pinSpacing: false,
      // 动画结束后销毁触发器（减少内存）
      onComplete: () => tl.scrollTrigger.kill()
    }
  })
  tl.to([
    '.first-screen .cloud-2',
    '.first-screen .cloud-1',
  ],{
    translateZ: 200,
    duration: 0.2
  },'<0.04')
  tl.to([
    '.first-screen .cloud-5',
  ],{
    translateZ: 200,
    duration: 0.2
  },'<0.04')
  tl.to([
    '.first-screen .mountain-5'
  ],{
    translateZ: 200,
    duration: 0.2
  })
  tl.to([
    '.first-screen .mountain-4'
  ],{
    translateZ: 200,
    duration: 0.2
  })
  tl.to([
    '.first-screen .cloud-6',
  ],{
    translateZ: 200,
    duration: 0.2
  })
  tl.to([
    '.first-screen .mountain-2',
    '.first-screen .mountain-3',
  ],{
    translateZ: 200,
    duration: 0.2
  },'<0.06')
  tl.to('.first-screen .text',{ translateZ: 200, duration: 0.2},'<0.1')
  tl.to('.first-screen .cloud-4',{ translateZ: 200, duration: 0.2},'<0.1')
  tl.to('.first-screen .cloud-3',{ translateZ: 200, duration: 0.2},'<0.1')
  tl.to('.first-screen .mountain-1',{ translateZ: 200, duration: 0.2},'<0.1')
  // tl.to('.first-screen',
  //     {
  //       opacity: 0,
  //       display: 'none',
  //       delay: 1
  //     },'<0.1')


}
const contentAnimation = () =>{
    gsap.set('.content-wrapper',{ y: -1000, opacity: 0})
    gsap.set('.img-picture',{ y: -2000})
    const screens = document.querySelectorAll('.content-box')
    screens.forEach((screen,index)=>{
      const tl = gsap.timeline({
        scrollTrigger:{
          trigger: screen,
             start: 'top top',
             end: '+=1080',
             scrub: true,
             pin: true,
             pinSpacing: false
        }
      })
      tl.to(screen.querySelector('.content-wrapper'),{
        y: 0,
        opacity: 1
      })
      tl.to(screen.querySelectorAll('.content-wrapper .img-map'),{
        y: 300,
        opacity: 0,
        duration: 1,
        ease: 'power2.out',
        delay: 1
      })
      tl.to(screen.querySelectorAll('.content-wrapper .img-picture'), {
        y: 0,
        duration: 1,
        ease: 'power2.out'
      },'-=1')
      if(index < 4){
        tl.to(screen,{
          y: -1080,
        })
        tl.to(screen.querySelectorAll('.img-bg'),{
          opacity: 0,
        },'<')
        tl.to(screen.querySelectorAll('.content-wrapper'),{
          y: +600,
          opacity: 0
        },'<')
      }
    })
}
// 优化视频播放避免卡顿
const videoElements = ref(null)
onMounted(()=>{
  videoElements.value = document.querySelectorAll('video');
  videoElements.value.forEach(video => {
    const parentScreen = video.closest('.screen');
    ScrollTrigger.create({
      trigger: parentScreen,
      start: 'top bottom',
      end: 'bottom top',
      onEnter: () => video.play(),
      onLeave: () => video.pause(),
      onEnterBack: () => video.play(),
      onLeaveBack: () => video.pause(),
      idleTime: 0.5, // 减少监听频率
      once: false
    });
    // 初始暂停视频（避免页面加载就播放）
    video.pause();
  });

  firstAnimation()
  contentAnimation()
})
</script>
<style scoped>
.content-warpper{
  //padding-top: 1000px;
  //margin-bottom: 1000px;
}
.img-bg-video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  contain: paint;
  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    backface-visibility: hidden;
  }
}
.climate {
  position: relative;
  //height: 10000px; /* 6个屏幕 × 1080px */
}
.screen{
  overflow: hidden;
  //position: absolute;
  //top: 0;
  //width: 1920px;
  //height: 1080px;
}

.first-screen{
  width: 1920px;
  height: 1080px;
  overflow: hidden;
  background-image: url("@/assets/images/climate/climate-intro-bg.png");
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  perspective: 200px;
  transform-style: preserve-3d;
  transform: translateZ(0);
  will-change: transform;
  //position: absolute;
  //left: 0;
  //paddings-bottom: 1000px;
  .mountain-1{
    width: 1588px;
    height: 612px;
    background-image: url("@/assets/images/climate/climate-intro-mountain-1.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    left: 0;
  //z: -600;
  }
  .mountain-2{
    width: 1551px;
    height: 802px;
    background-image: url("@/assets/images/climate/climate-intro-mountain-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    right: 0;
  //z: -400;
  }
  .mountain-3{
    width: 551px;
    height: 565px;
    background-image: url("@/assets/images/climate/climate-intro-mountain-3.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    right: 0;
  //z: -400;
  }
  .mountain-4{
    width: 1805px;
    height: 288px;
    background-image: url("@/assets/images/climate/climate-intro-mountain-4.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    left: 0;
  }
  .mountain-5{
    width: 1345px;
    height: 225px;
    background-image: url("@/assets/images/climate/climate-intro-mountain-5.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    right: 0;
  }
  .cloud-1{
    width: 1121px;
    height: 367px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-1.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    right: 0px;
  }
  .cloud-2{
    width: 1494px;
    height: 424px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    left: 0px;
  }
  .cloud-3{
    width: 265px;
    height: 94px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-3.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 510px;
    left: 548px;
  }
  .cloud-4{
    width: 411px;
    height: 330px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-4.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 392px;
    left: 100px;
  }
  .cloud-5{
    width: 554px;
    height: 509px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-5.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0px;
    left: 0px;
  }
  .cloud-6{
    width: 620px;
    height: 235px;
    background-image: url("@/assets/images/climate/climate-intro-cloud-6.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 302px;
    right: 46px;
  }
  .text{
    font-size: 25px;
    color: #293643;
    width: 910px;
    line-height: 48px;
    position: absolute;
    top: 266px;
    left: 122px;
    right: 0;
    transformStyle: 'preserve-3d';
    z: -400;
    span{
      font-size: 50px;
      color: #3d531a;
    }
  }
}
.second-screen{
  width: 1920px;
  height: 1080px;
  background-image: url("@/assets/images/climate/climate-qtgy-bg-1.png");
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  .img-bg{
    width: 1920px;
    height: 356px;
    background-image: url("@/assets/images/climate/climate-qtgy-bg-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0;
    left: 0;
  }
  .img-map{
    width: 699px;
    height: 353px;
    background-image: url("@/assets/images/climate/climate-qtgy-map.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 362px;
    right: 152px;
  }
  .img-picture{
    width: 727px;
    height: 482px;
    background-image: url("@/assets/images/climate/climate-qtgy-picture.jpg");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 300px;
    right: 140px;
    border-radius: 20px;
  }
  .detail{
    position: absolute;
    top: 390px;
    left: 140px;
    .title{
      font-size: 52px;
      color: #fff;
      margin-bottom: 44px;
    }
    p{
      width: 790px;
      font-size: 24px;
      color: #fff;
      line-height: 48px;
    }
  }
}
.third-screen{
  width: 1920px;
  height: 1080px;
  background-image: url("@/assets/images/climate/climate-cdm-bg-1.png");
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  .img-bg{
    width: 1920px;
    height: 492px;
    background-image: url("@/assets/images/climate/climate-cdm-bg-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    bottom: 0px;
    left: 0px;
  }
  .img-map{
    width: 699px;
    height: 350px;
    background-image: url("@/assets/images/climate/climate-cdm-map.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 362px;
    right: 152px;
  }
  .img-picture{
    width: 721px;
    height: 481px;
    background-image: url("@/assets/images/climate/climate-cdm-picture.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 300px;
    right: 140px;
    border-radius: 20px;
  }
  .detail{
    position: absolute;
    top: 390px;
    left: 140px;
    .title{
      font-size: 52px;
      color: #fff;
      margin-bottom: 44px;
    }
    p{
      width: 790px;
      font-size: 24px;
      color: #fff;
      line-height: 48px;
    }
  }
}
.four-screen{
  width: 1920px;
  height: 1080px;
  //background-image: url("@/assets/images/climate/climate-zngd-bg-2.png");
  //background-size: cover;
  //background-position: center center;
  //background-repeat: no-repeat;
  //z-index: 3;

  .img-bg{
    video{
      width: 1920px;
      height: 1080px;
      position: absolute;
      top: 0;
      left: 0;
    }
  }
  .img-bg-2{
    width: 1920px;
    height: 1080px;
    background-image: url("@/assets/images/climate/climate-zngd-bg-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 0;
    left: 0;
    //z-index: 3;
  }
  .img-map{
    width: 699px;
    height: 350px;
    background-image: url("@/assets/images/climate/climate-zngd-map.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 362px;
    right: 152px;
  }
  .img-picture{
    width: 721px;
    height: 481px;
    background-image: url("@/assets/images/climate/climate-zngd-picture.jpg");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 300px;
    right: 140px;
    border-radius: 20px;
  }
  .detail{
    position: absolute;
    top: 390px;
    left: 140px;
    .title{
      font-size: 52px;
      color: #fff;
      margin-bottom: 44px;
    }
    p{
      width: 790px;
      font-size: 24px;
      color: #fff;
      line-height: 48px;
    }
  }
}
.five-screen{
  width: 1920px;
  height: 1080px;
  background: #557ea3;

  .img-bg{
    width: 1920px;
    height: 768px;
    background-image: url("@/assets/images/climate/climate-hds-bg-2.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    left: 0;
    bottom: 0;
  }
  .img-bg-2{
    video{
      width: 1920px;
      height: 1080px;
      position: absolute;
      left: 0;
      bottom: 0;
    }
  }
  .img-map{
    width: 699px;
    height: 350px;
    background-image: url("@/assets/images/climate/climate-hds-map.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 362px;
    right: 152px;
  }
  .img-picture{
    width: 721px;
    height: 481px;
    background-image: url("@/assets/images/climate/climate-hds-picture.jpg");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 300px;
    right: 140px;
    border-radius: 20px;
  }
  .detail{
    position: absolute;
    top: 390px;
    left: 140px;
    .title{
      font-size: 52px;
      color: #fff;
      margin-bottom: 44px;
    }
    p{
      width: 790px;
      font-size: 24px;
      color: #fff;
      line-height: 48px;
    }
  }
}
.six-screen{
  width: 1920px;
  height: 1080px;
//background-image: url("@/assets/images/climate/climate-zngd-bg-2.png");
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  .img-map{
    width: 699px;
    height: 350px;
    background-image: url("@/assets/images/climate/climate-zdn-map.png");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 362px;
    right: 152px;
  }
  .img-picture{
    width: 721px;
    height: 481px;
    background-image: url("@/assets/images/climate/climate-zdn-picture.jpg");
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    position: absolute;
    top: 300px;
    right: 140px;
    border-radius: 20px;
  }
  .detail{
    position: absolute;
    top: 390px;
    left: 140px;
    .title{
      font-size: 52px;
      color: #fff;
      margin-bottom: 44px;
    }
    p{
      width: 790px;
      font-size: 24px;
      color: #fff;
      line-height: 48px;
    }
  }
}
</style>